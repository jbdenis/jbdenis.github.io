<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf8">
  <meta name="creation" content=" 2021_09_14@17:07 ">
  <meta http-equiv="charset" content="utf8">
  <title>phoges.pm</title>
</head>
<body>
<h2>
MODULE phoges
</h2>
<p><pre>
</pre></p>
<par>
To get the content of the module <a href="phoges.pm">phoges.pm</a>
</par>
<p>
&nbsp;
&nbsp;
A total of 23 subroutines was detected:
&nbsp;
</p>
<table border="3">
  <tbody>
    <tr>
    </tr>
      <td><strong>analyze</strong></td>
      <td>
<a href="#sub analyze8line {">
analyze8line
</a>
      </td>
      <td>
<a href="#sub analyze8named7vector {">
analyze8named7vector
</a>
      </td>
    <tr>
    </tr>
      <td><strong>check</strong></td>
      <td>
<a href="#sub check8pi {">
check8pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>col</strong></td>
      <td>
<a href="#sub col7pi2ind7pi {">
col7pi2ind7pi
</a>
      </td>
      <td>
<a href="#sub update8col7pi {">
update8col7pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>date</strong></td>
      <td>
<a href="#sub get8date {">
get8date
</a>
      </td>
    <tr>
    </tr>
      <td><strong>di</strong></td>
      <td>
<a href="#sub di7f2tex1htm {">
di7f2tex1htm
</a>
      </td>
      <td>
<a href="#sub ei7f2di7f1ic7f {">
ei7f2di7f1ic7f
</a>
      </td>
      <td>
<a href="#sub shrink8di7f {">
shrink8di7f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>ei</strong></td>
      <td>
<a href="#sub ei7f2di7f1ic7f {">
ei7f2di7f1ic7f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>f</strong></td>
      <td>
<a href="#sub di7f2tex1htm {">
di7f2tex1htm
</a>
      </td>
      <td>
<a href="#sub ei7f2di7f1ic7f {">
ei7f2di7f1ic7f
</a>
      </td>
      <td>
<a href="#sub purge8st7f {">
purge8st7f
</a>
      </td>
      <td>
<a href="#sub read8ic7f {">
read8ic7f
</a>
      </td>
      <td>
<a href="#sub read8sl7f {">
read8sl7f
</a>
      </td>
      <td>
<a href="#sub read8st7f {">
read8st7f
</a>
      </td>
      <td>
<a href="#sub shrink8di7f {">
shrink8di7f
</a>
      </td>
      <td>
<a href="#sub st4f {">
st4f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>fit</strong></td>
      <td>
<a href="#sub fit8image {">
fit8image
</a>
      </td>
    <tr>
    </tr>
      <td><strong>get</strong></td>
      <td>
<a href="#sub get8date {">
get8date
</a>
      </td>
    <tr>
    </tr>
      <td><strong>htm</strong></td>
      <td>
<a href="#sub di7f2tex1htm {">
di7f2tex1htm
</a>
      </td>
    <tr>
    </tr>
      <td><strong>ic</strong></td>
      <td>
<a href="#sub ei7f2di7f1ic7f {">
ei7f2di7f1ic7f
</a>
      </td>
      <td>
<a href="#sub read8ic7f {">
read8ic7f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>ima</strong></td>
      <td>
<a href="#sub ima7line9 {">
ima7line9
</a>
      </td>
    <tr>
    </tr>
      <td><strong>image</strong></td>
      <td>
<a href="#sub fit8image {">
fit8image
</a>
      </td>
      <td>
<a href="#sub image9 { ">
image9
</a>
      </td>
      <td>
<a href="#sub select8image {">
select8image
</a>
      </td>
    <tr>
    </tr>
      <td><strong>ind</strong></td>
      <td>
<a href="#sub col7pi2ind7pi {">
col7pi2ind7pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>line</strong></td>
      <td>
<a href="#sub analyze8line {">
analyze8line
</a>
      </td>
      <td>
<a href="#sub ima7line9 {">
ima7line9
</a>
      </td>
      <td>
<a href="#sub pi2line {">
pi2line
</a>
      </td>
    <tr>
    </tr>
      <td><strong>named</strong></td>
      <td>
<a href="#sub analyze8named7vector {">
analyze8named7vector
</a>
      </td>
    <tr>
    </tr>
      <td><strong>new</strong></td>
      <td>
<a href="#sub new7pi {">
new7pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>pi</strong></td>
      <td>
<a href="#sub check8pi {">
check8pi
</a>
      </td>
      <td>
<a href="#sub col7pi2ind7pi {">
col7pi2ind7pi
</a>
      </td>
      <td>
<a href="#sub new7pi {">
new7pi
</a>
      </td>
      <td>
<a href="#sub pi2line {">
pi2line
</a>
      </td>
      <td>
<a href="#sub pi9 {">
pi9
</a>
      </td>
      <td>
<a href="#sub print8pi {">
print8pi
</a>
      </td>
      <td>
<a href="#sub update8col7pi {">
update8col7pi
</a>
      </td>
      <td>
<a href="#sub update8st7pi {">
update8st7pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>print</strong></td>
      <td>
<a href="#sub print8pi {">
print8pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>purge</strong></td>
      <td>
<a href="#sub purge8st7f {">
purge8st7f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>read</strong></td>
      <td>
<a href="#sub read8ic7f {">
read8ic7f
</a>
      </td>
      <td>
<a href="#sub read8sl7f {">
read8sl7f
</a>
      </td>
      <td>
<a href="#sub read8st7f {">
read8st7f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>select</strong></td>
      <td>
<a href="#sub select8image {">
select8image
</a>
      </td>
    <tr>
    </tr>
      <td><strong>shrink</strong></td>
      <td>
<a href="#sub shrink8di7f {">
shrink8di7f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>sl</strong></td>
      <td>
<a href="#sub read8sl7f {">
read8sl7f
</a>
      </td>
    <tr>
    </tr>
      <td><strong>st</strong></td>
      <td>
<a href="#sub purge8st7f {">
purge8st7f
</a>
      </td>
      <td>
<a href="#sub read8st7f {">
read8st7f
</a>
      </td>
      <td>
<a href="#sub st4f {">
st4f
</a>
      </td>
      <td>
<a href="#sub update8st7pi {">
update8st7pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>tex</strong></td>
      <td>
<a href="#sub di7f2tex1htm {">
di7f2tex1htm
</a>
      </td>
    <tr>
    </tr>
      <td><strong>update</strong></td>
      <td>
<a href="#sub update8col7pi {">
update8col7pi
</a>
      </td>
      <td>
<a href="#sub update8st7pi {">
update8st7pi
</a>
      </td>
    <tr>
    </tr>
      <td><strong>vector</strong></td>
      <td>
<a href="#sub analyze8named7vector {">
analyze8named7vector
</a>
      </td>
    <tr>
    </tr>
      <td><strong>z...</strong></td>
  </tbody>
</table>
<ol>
<li>
<a href="#sub analyze8line {">
sub analyze8line {            (get type and content from an eif line)
</a>
</li>
<li>
<a href="#sub analyze8named7vector {">
sub analyze8named7vector {    (get the values of a line similar to technical ones)
</a>
</li>
<li>
<a href="#sub check8pi {">
sub check8pi {                (check the validity of a pi series)
</a>
</li>
<li>
<a href="#sub col7pi2ind7pi {">
sub col7pi2ind7pi {           (prepare an individual pi.s)
</a>
</li>
<li>
<a href="#sub di7f2tex1htm {">
sub di7f2tex1htm {            (generates a latex|html file from a dif file)
</a>
</li>
<li>
<a href="#sub ei7f2di7f1ic7f {">
sub ei7f2di7f1ic7f {          (transforming an eif into a dif or a icf)
</a>
</li>
<li>
<a href="#sub fit8image {">
sub fit8image {               (transform one image to an exact precision)
</a>
</li>
<li>
<a href="#sub get8date {">
sub get8date {                (date of a picture)
</a>
</li>
<li>
<a href="#sub ima7line9 {">
sub ima7line9 {               (is it an image line?)
</a>
</li>
<li>
<a href="#sub image9 { ">
sub image9 {                  (return some characteristics of an image)
</a>
</li>
<li>
<a href="#sub new7pi {">
sub new7pi {                  (return a pi series)
</a>
</li>
<li>
<a href="#sub pi2line {">
sub pi2line {                 (generates a line from a series of pi.s)
</a>
</li>
<li>
<a href="#sub pi9 {">
sub pi9 {                     (test the existence of pi into a pi series)
</a>
</li>
<li>
<a href="#sub print8pi {">
sub print8pi {                (print any pi)
</a>
</li>
<li>
<a href="#sub purge8st7f {">
sub purge8st7f {              (eliminate multiple definition of shortcuts)
</a>
</li>
<li>
<a href="#sub read8ic7f {">
sub read8ic7f {               (read an icf file to extract some components)
</a>
</li>
<li>
<a href="#sub read8sl7f {">
sub read8sl7f {               (reading a slf file)
</a>
</li>
<li>
<a href="#sub read8st7f {">
sub read8st7f {               (reading a stf file)
</a>
</li>
<li>
<a href="#sub select8image {">
sub select8image {            (selection of images)
</a>
</li>
<li>
<a href="#sub shrink8di7f {">
sub shrink8di7f {             (shrink a dif and increase its levels)
</a>
</li>
<li>
<a href="#sub st4f {">
sub st4f {                    (get shortcuts from a 'stf' )
</a>
</li>
<li>
<a href="#sub update8col7pi {">
sub update8col7pi {           (update the collective pi.s)
</a>
</li>
<li>
<a href="#sub update8st7pi {">
sub update8st7pi {            (replace shortcuts by their values)
</a>
</li>
</ol>
<h2>
General Presentation of phoges.pm
</h2>
<p><pre>
#
# 'phoges' for 'photo-gestion'.
#
# This module was written to support a series of
# programs focused to the annotation of my photos. Principles
# are presented in a small document named 'annotation-photo'.
#
# Nevertheless some words have to be added here to precise
# which Perl structures are associated to the different concepts.
#
# To each picture can be associated:
#    - a name, but take care that the same name cannot be attributed
#              to different pictures even in different directories !!!
#    - a set of nested circumstances, comprising at least one element
#    - a time period, "0000" when it is missing,
#    - a set of places, possibly empty,
#    - a set of people, possibly empty,
#    - a set of keywords, possibly empty,
#    - a set of categories, possibly empty,
#    - a set of paragraphs for the comment, possibly empty.
# 
# The storage of this information is done through four important
# structures : individual pi.s, collective pi.s, circumstance pi.s
# and additional pi.s. Empty ones can be created with &new7pi (where
# they are implicitly described and their validity checked with
# check8pi.
#
# A set of pictures ('sepi') is coded with a hash whose keys
# are their names and the value is a reference to
# an array of size 5 such that
#   [0] refers to a string giving the date,
#   [1] refers to an array of the circumstances,
#   [2] refers to an array of the categories,
#   [3] refers to an array of the keywords,
#   [4] refers to an array of the comment paragraphs.
#
# IT IS STRONGLY SUGGESTED TO READ THE DOCUMENT
# 'annotation-photo.pdf' WHERE THE GENERAL
# APPROACH IS PRESENTED.
#
</pre></p>
<h2>
<a name="sub analyze8line {"></a>
1 sub analyze8line {
</h2>
<p><pre>
    #
    # title : get type and content from an eif line
    #
    # aim : the line to analyze can be
    #      (0) a specific line to be ignored 
    #          starting with a value of %telquel
    #      (i) an image line with all possible pi.s
    #          leading to an ind-pi
    #     (ii) a circumstance line, then this is
    #          its only pi leading to a cir-pi
    #    (iii) a collective line, proposing pi.s
    #          for futher images leading to a col-pi
    #      
    #      Other line types are considered as
    #          an error.
    # 
    #      'lit' argument is reserved for self calls
    #          it provides the type of pi to be
    #          analyzed.
    #
    # output : 
    #        In case of (0) a pi of type 'spe' is returned 
    #         with the complete content in key 'c'.
    #        If not the associated pi to the line.
    #         Of course, an error message when some
    #         inconsistency in the input is found.
    #         ((or its contents when the type is given in input,
    #           'undef' when not present.)).
    #        In case of inconsistency an error is returned.
    #
    # remarks :
    #           * shortcuts are not transformed but attibuted to
    #             pi-type
    #           * they is no distinction between 'ind'/'IND' or
    #             'col'/'COL' series so c-pi.s can be included
    #             and the pi-type attributed in ->{y} will be
    #             'ind' or 'col' according to the image presence
    #             at the beginning of the line. The true type
    #             must be attributed after the call to 'analyze8line'
    #             and the consistency of the content check at this
    #             moment.
    #
    # arguments
    my $hrsub = {lin  => [undef,"c","The line to analyze"],
                 sht  => [   {},"h","Definition of the shortcuts"],
                 lit  => [   "","c","When '', line type is asked for",
                                    "else must be a valid line type and",
                                    "the content will be returned whereever it is."]
                };
</pre></p>
<h2>
<a name="sub analyze8named7vector {"></a>
2 sub analyze8named7vector {
</h2>
<p><pre>
    #
    # title : get the values of a line similar to technical ones
    #
    # aim : an axillary function to aliviate
    #      and secure the programming task
    #      when getting different components similar to
    #      technical parameters
    #
    # output : an error object if something
    #         was wrong, if not a hash with
    #         different components using natural keys
    #
    # arguments
    my $hrsub = {lin  =>[undef, "uc","The string to analyze"],
                 sep  =>[undef, "c","Separators between components"],
                 def  =>[   {}, "h","Default values for some components"]
                };
</pre></p>
<h2>
<a name="sub check8pi {"></a>
3 sub check8pi {
</h2>
<p><pre>
    #
    # title : check the validity of a pi series
    #
    # aim : to ease the programming task. Can be avoid with
    #      the global variable $pi7check.
    # 
    #  Have a look to the code to know what are the components of
    #      of the different types of pi.s. These are given by
    #      '$xpi->{y} which is compulsory and can take the
    #      following six values: 
    #        'ind' pi of a precise image (individual)    
    #              where c-pi are forbidden, nevertheless
    #              they must exist but void.
    #        'IND' pi of a precised image (individual in ICF)
    #              where c-pi are compulsory
    #        'col' for a collective definition of pi from a line
    #        'COL' for the current state of collective pi through
    #              the exploration of EIF/DIF comprising the
    #              complete record of the hierarchy
    #        'cir' circumstances
    #        'ext' for external paragraph
    #        'spe' for specific lines external to phoges
    #
    #   - Array components must be [] when empty
    #   - String components must be "" when empty
    #
    # output : 1 when right if not an error
    #
    # arguments
    my $hrsub = {xpi  =>[undef,  "h","The series of pi.s to check"],
                 whi  =>[   "",  "c","The expected type of pi; default is any type"]
                };
</pre></p>
<h2>
<a name="sub col7pi2ind7pi {"></a>
4 sub col7pi2ind7pi {
</h2>
<p><pre>
    #
    # title : prepare an individual pi.s
    #
    # aim : using the current collective pi.s
    #        adapt an individual pi.s.
    # 
    # output : an error object if something
    #         was wrong, if not a hash with
    #         different pi.s corresponding
    #         to the individual pi series:
    #         'ind' or 'IND' according to
    #         the absence/presence of 'c' in
    #         argument 'cum'
    #
    # remarks:
    #         (i) escaped pi.s are left are they are
    #             (escaping commands are looked for within the
    #              categories). For instance '--kg--' means that
    #              k-pi and g-pi must not be introduced.
    #              Beware that when a pi is escaped, it is not
    #              introduced even if asked with the argument 'cum'
    #
    # arguments
    my $hrsub = {cpi  =>[undef,  "h","collective pi.s"],
                 ipi  =>[undef,  "h","Individual pi.s to adjust"],
                 lpi  =>[undef,  "h","pi.s of the last image in case of 'identical'"],
                 cum  =>[undef,  "c","A string indicating which pi.s must be cumulated.",
                                     "For instance 'mkgd' indicates that only collective",
                                     "comments, keywords, categories and directory must",
                                     "be cumulated"]
                };
</pre></p>
<h2>
<a name="sub di7f2tex1htm {"></a>
5 sub di7f2tex1htm {
</h2>
<p><pre>
    #
    # title : generates a latex|html file from a dif file
    #
    # aim : produce catalogues from series of annotated
    #      pictures.
    # 
    # output : either an error object if something
    #         was wrong, or just 1.
    #
    # remarks :(x) Preexisting tex and html files will be destroyed.
    #          (x) For the moment, only the following technical parameters
    #              are taken into account. They can be collective [C] and/or
    #              individual [I]  (as examples):
    #                 - [CI] 'wid=3cm' width of the images,
    #                 - [CI] 'hei=5cm' height of the images
    #                 - [CI] 'wha=nhw' what to introduce instead of image/item
    #                 - [CI] 'chk=0'   must the presence of the file be checked
    #                 - [C]  'WID=3cm' width of the images,
    #                 - [C]  'HEI=5cm' height of the images
    #                 - [C]  'WHA=nhw' what to introduce instead of image/item
    #                 - [C]  'CHK=0'   must the presence of the file be checked
    #                 - [I]  'rot=-90' the rotation to apply to the image (default 0),
    #                 - [I]  'vsp= 2' the vertical space to introduce between image and caption,
    #                 - [C]  'nbi=3' number of images to introduce into a grid (default 1),
    #                 - [C]  'gnl=2' number of lines into the grid (default 1),
    #                 - [C]  'gnc=2' number of columns of the grid (default 1)
    #                 - [C]  'cap=common features are...' possible collective caption for a
    #                               a grid of images
    #                    (See below to know how they are used),
    #          (x) Be aware that some collective pi.s can be lost if not associated to 
    #                 a set of images. The aim is to annotate, not to build a text.
    #                 For that, other tools are available, in particular lines starting
    #                 with '(*)'. The loss is made when building the DIF from the EIF.
    #
    #
    #  Here are the main rules about the technical parameters [TP]:
    #   * Individual TPs only apply to the present image.
    #   * When 'wid' and/or 'hei' is present in individual TP,
    #     collective 'wid/hei/WID/HEI' are not considered for the present image
    #     but are still considered for the following ones until they be
    #     resetted.
    #   * 'nbi','gnl','gnc','cap' are only possible at a collective level, they apply only to 
    #     the following grid (reset to the default afterwards).
    #   * 'rot' is only possible at an individual level.
    #   * For the moment, 'cap' is reduced to a simple comment.
    #   * A collective line with explicit technical parameters 'nbi' is supposed to be followed by
    #                 'nbi' image lines. If not a fatal error is raised.
    #   * A new collective TP line resets previous values to the default if not defined
    #     except TP 'WID/HEI/WHA/CHK' which are resetted only by a void collective TP
    #   * To retrieve all default values of collective TPs just introduce a void one '<[]>'.
    #   * When 'wid' and 'WID' are defined, 'wid' is used
    #   * When 'hei' and 'HEI' are defined, 'hei' is used
    #
    #
    # arguments
    my $hrsub = {dif  =>[undef,  "c","Name root of the dif (decoded index file)"],
                 roo  =>[    0,  "c","Prefix of the latex/html files to generate",
                                     " (without '.tex' or '.html' suffix)",
                                     "When '0' the default value, the name is taken from the dif."],
                 ppa  =>[{},"h","hash allowing to modify a number of default parameters,",
                                "more precisely:",
                                " - the argument 'par' of &lhattmel::start, description and default values in %pls",
                                " - some latex specifications (default in %plt):",
                                "       . num=>0 for the sections,... not to be numbered (default 1)",
                                "       . red=>0.5 to get the picture half the size which is specified",
                                "                  in the technical parameters (default 1)",
                                "       . pbn=>2 to indicate until which section level a page break must be introduced",
                                " - framing used when building the picture captions (default in %cfra):",
                                "     'cfraon' for the 'o'pening of the 'n'ame",
                                "     'cfracp' for the 'c'losing of the 'p'lace",
                                "              and so on (see the 'cfra' definition)",
			        " - 'subdir' as a logical to indicate if subdirectories indicated within",
			        "            the <dif> input must be used or not",
                                " - separating components when building the picture captions (default in %sepb):",
                                "     'sepbn' for the 'n'ame",
                                "     'sepbp' for the 'p'lace",
                                "              and so on (see the 'cfra' definition)"],
                 cap  =>["Intpmx","c","Define the way to compute individual captions:",
                                      "'I' for identifying the different components (see %phoges::id)",
                                      "'B' for introducing a new line between the components: doesn't work",
                                      "'X' for indicating missing fields",
                                      " 'n','t','p','q','k','g','m' to introduce them.",
                                      "(Notice that the technical parameters 'h' cannot be included",
                                      " since it is not an array but a hash so the same algorithm",
                                      "cannot be used.)"],
                 rdi  =>[  ".",  "c","root directory from which images including their private directories",
                                     "can be found"],
                 typ  =>[  "l",  "c","type of the output : 'l' for latex, 'h' for html"]
                };
</pre></p>
<h2>
<a name="sub ei7f2di7f1ic7f {"></a>
6 sub ei7f2di7f1ic7f {
</h2>
<p><pre>
    #
    # title : transforming an eif into a dif or a icf
    #
    # aim : produces either a decoded index file (dif) 
    #      or a image centered file (icf) from an edited
    #      index file (eif). A central subroutine for
    #      the pg.album program since all used conventions
    #      are implemented in it.
    # 
    # output : 1 when the analysis of the edited
    #         file was without trouble, if not an 
    #         error message testable with '&uie::err9'
    #         and printable with '&uie::print8err'.
    #
    #   The definition of shortcuts for people, categories and keywords
    #         can be done within the eif and/or through specialized
    #         stf files indicated with a stf line.
    #
    #   A dif is just the eif after:
    #           - replacing shortcuts by their value (except for categories)
    #           - including all used categories within the index file
    #             (and only the necessary ones)
    #           - attributing at an individual level time period,
    #             place, people, category, keyword.
    #
    #   A icf is the list of images after integrating in them all
    #           collective attributions, including the title,
    #           only are left the directory lines and those
    #           defining the categories plus, of course, image lines.
    #
    #   To the transformation can be added a selection of the retained
    #          images according to some criteria (defined in a slf file).
    #
    #   BE AWARE THAT SOME COLLECTIVE PI.S CAN BE LOST if not associated to 
    #          a set of images. The aim is to annotate, not to build a text,
    #          so information not focused to annotation of pictures is 
    #          not considered. Nevertheless upper case technical parameters
    #          are not lost except when an empty set is proposed.
    #
    #   Nevertheless, you can write paragraphs (then also lists, see lhattmel::parag
    #          subroutine) with the specific lines starting with (*).
    #
    #   To give more flexibility in producing documents, specific lines are
    #          reproduce without interpretation or checking in the dif file. These are
    #          marked up with values of %telquel.
    #
    #   As the subroutine is quite long and intricated, possible intermediary
    #          printing can be asked by modifying the local variable $impint.
    #
    # TO DO: Clarify and improve the management of collective pi, Why not
    #        allow successive definition for upper case technical parameters?
    #        Why no repeat them at the beginning of each new circumstance in 
    #        the produced eif, even if they are not modified?
    #
    # arguments
    my $hrsub = {eif  =>[undef,  "c","The root of the edited index file to transform",
                                     "('-eif.txt' suffix will be added)."],
                 out  =>[undef,  "c","The root of the transformed file to create",
                                     "('-dif.txt' or '-icf.txt' suffix will be added)."],
                 typ  =>["dif",  "c","Type of the created file if not must be 'icf'"],
                 new  =>[    1,  "n","Must not the 'out' file to already exist?",
                                     "If so and 'bsk' is not provided a message error is",
                                     "returned. Whenissued. When 'bsk' is provided,",
                                     "it is replaced after being saved into the basket."],
                 slf  =>[   "",  "c","Root of the selection definition file to use",
                                     "when '', no selection is performed",
                                     "('-slf.txt' suffix will be added).",
			             "Only selected images are left in the output file"],
		 bsk  =>[   "",  "c","The basket where to save the output file",
			             "if it exists and 'new' is 1 except to the default",
			             "value ''."]
                };
</pre></p>
<h2>
<a name="sub fit8image {"></a>
7 sub fit8image {
</h2>
<p><pre>
    #
    # title : transform one image to an exact precision
    #
    # aim : produce images with convenient sizes
    #         from an original image base, accordingly
    #         with the dimensions they will be printed.
    #      When both height and width of the destination
    #         image are given, the resulting image
    #         can be not homothetic to the original one,
    #         this is why usually either only one dimension
    #         is given, the other is computed
    #      Already prepared (according to epr and eps 
    #         criteria) images are not rebuilt.
    #      The original image cannot be modified.
    #
    # notice that care can be taken from the portrait shots
    #        with the auto-orient option of ImageMagick::convert
    #
    # remarks : x ImageMagick facilities are used
    #           x Perl module Image::Size is used to know image dimensions
    #           x a temporary original is created, possibly
    #             auto-oriented, and then deleted.
    #           x Resulting image can be a magnified image
    #
    # TO REMEMBER : in a first step, I gave the same name
    #               for the temporary file but PERL was to fast
    #               with respect to the file copy/delete that
    #               this produced a terrific mess!
    #
    # output : [$orient,$transf]
    #           $orient = 1 if auto-orientation was applied
    #                     0 if not
    #           $transf = 1 when the image has been transformed
    #                     0 a convenient image was already present
    #
    #           or an error message when something went wrong
    #
    # arguments
    my $hrsub = {orf  =>[undef,  "c","Name of the original picture file"],
                 def  =>[undef,  "c","Name of the destination picture file"],
                 auo  =>[    0,  "n","Must auto-orientation transformation be applied",
                                     "on the original image (will be kept untouched)",
                                     "before the potential selection for transformation?"],
                 hei  =>["0mm",  "cu","Height dimension of the printed picture (eg: 5.4cm),", 
                                     "must be given 'cm' or 'mm' (lower case), can be 'undef'",
                                     "A value of '0' or 'undef' means that this argument must not be considered",
                                     "but either 'hei' or 'wid' must be given if not 'wid' will be put to '8cm'"],
                 wid  =>["0mm",  "cu","Width dimension of the printed picture (same details as 'hei')"],
                 ppi  =>[  300,  "n","Desired number of pixels per inch for the destination picture.",
                                      "When zero, the original image will just copied",
                                      "When negative, the number of pixels for the greater dimension"],
                 eps  =>[  0.02, "n","Relative tolerance limit to accept an already existing destination file"],
                 qua  =>[    85, "n","Quality percentage to use with the 'convert' commande"],
                 imp  =>[    1,  "n","0: no message; 1: found dimensions displayed,",
                                     "2: convert displayed, 3: 1+2"],
                 tmp  =>["."  ,  "c","directory where to place the temporary copy of the original image file"]
                };
</pre></p>
<h2>
<a name="sub get8date {"></a>
8 sub get8date {
</h2>
<p><pre>
    #
    # title : date of a picture
    #
    # aim : determine the date of a picture
    # 
    # output : a string associated to the date,
    #         possibly "".
    #
    # arguments
    my $hrsub = {nam  =>[undef,  "c","The file name of the picture"],
                 tim  =>[   "",  "cu","The date proposed by the annotation file,",
                                      "can be the year when 'pmdd*' coding",
                                      "not taken into account when the name is",
                                      "formatted 'yyyy_mm_dd.*'."]
                };
</pre></p>
<h2>
<a name="sub ima7line9 {"></a>
9 sub ima7line9 {
</h2>
<p><pre>
    #
    # title : is it an image line?
    #
    # aim : test if the line of eif/dif/icf describes
    #       an image
    # 
    # output : 1 if yes, 0 if not
    #          or possibly an error message
    #
    # arguments
    my $hrsub = {lin  =>[undef,  "c","The line to test"]
                };
</pre></p>
<h2>
<a name="sub image9 { "></a>
10 sub image9 { 
</h2>
<p><pre>
    #
    # title : return some characteristics of an image
    #
    # aim : first the size, to be futher extended
    # 
    # output : when 'out' eq 'tout':
    #          a reference to a hash having, among others:
    #            suf => 0|1 if reckonized suffix (belongs to %prim)
    #            exi => 0|1 if 
    #            siz => [wid,hei,type] numbers of pixels of the image if it is plus the detected type
    #            ori =>  1|8|3|6 corresponding to a needed rotation of 0|90|180|270 degrees
    #          if not the asked component
    #
    #   Identify from ImageMagick is invoked only when the orientation is asked for
    #            or when a complete scan of the image characteristics (default 'out')
    #            is required.
    #
    # arguments
    my $hrsub = {ifi  =>[undef,  "c","Image File Name"],
                 out  =>[   "",  "c","'e' for existence of the file",
                                     "'s' for image suffix",
                                     "'S' for a reference to an array of size but undef if not an image",
                                     "'o' for the orientation",
                                     "'tout' to get everything within a hash"]
                };
</pre></p>
<h2>
<a name="sub new7pi {"></a>
11 sub new7pi {
</h2>
<p><pre>
    #
    # title : return a pi series
    #
    # aim : create a void|complete pi which can be:
    #         - an [ind|IND]ividual pi, describing an image
    #         - a [col|COL]lective pi, all information
    #           gathered outside image descriptions
    #         - a [cir]cumstance
    #
    # remarks - compulsory name is set to 'NULL.PNG'
    #         - compulsory hierarchical structure in COL series
    #           is set to ["",""] and associated vector pi.s
    #           to [[],[]]
    #
    # output : the empty|complete newly created
    #          or an error when the input is not accepted.
    #
    # arguments
    my $hrsub = {wha  =>[undef,  "c","The type to create 'ind | IND | col | COL | cir'"],
                 fil  =>[    0,  "n","Indicate if the pi series must be filled"]
                };
</pre></p>
<h2>
<a name="sub pi2line {"></a>
12 sub pi2line {
</h2>
<p><pre>
    #
    # title : generates a line from a series of pi.s
    #
    # aim : mainly used to write lines when creating dif and icf.
    #       Of course, non-empty components are included.
    #       The line is different according to the pi series type
    #       which can be 'ind', 'COL' or 'cir' for dif,
    #                    'IND' for icf
    #       but no care of the file being created at this level.
    #        for "m","p","q","k","g".
    #      When an individual pi are given only non empty
    #        components are considered.
    #
    # remarks: + in case of COL-pi.s, only the components to the last
    #            level are considered 
    #
    # output : a single string
    #          or an error when something is not
    #            acceptable
    #
    # arguments
    my $hrsub = {xpi  =>[undef,  "h","The pi-series to translate"],
                 xco  =>[    0,  "n","Must a 'col' be accepted?",
                                     " (exception introduced for 'shrink8dif')"]
                };
</pre></p>
<h2>
<a name="sub pi9 {"></a>
13 sub pi9 {
</h2>
<p><pre>
    #
    # title : test the existence of pi into a pi series
    #
    # aim : just for pi series ind/IND/col/COL/cir
    #         detects if the asked pi is not void
    #
    # remarks: not a great subroutine but a good way 
    #          to define what is considered as void for
    #          the different pi.s.
    #          As the aim is not to check the pi series,
    #          voidness is extended to non existence.
    #          Take care that the output is not a boolean.
    #
    # output : -1 doesn't exist
    #           0 exists and void
    #           1 exists and filled
    #
    #          in case of inconsistency: a fatal error.
    #
    # arguments
    my $hrsub = {xpi  =>[undef,  "h","The pi series to scan; must be 'ind | IND | col | COL | cir'"],
                 wha  =>[undef,  "c","The component to look for voidness"]
                };
</pre></p>
<h2>
<a name="sub print8pi {"></a>
14 sub print8pi {
</h2>
<p><pre>
    #
    # title : print any pi
    #
    # aim : print a small title and the structure itself
    #
    # output : 1 or an error when the pi is valid according to $pi7check.
    #
    # arguments
    my $hrsub = {xpi  =>[undef,  "h","The pi.s to print"],
                 eve  =>[    0,  "n","Must empty components be displayed for types ind/IND/col/COL?"],
                 chk  =>[    1,  "n","Must the validity of the 'pi' be checked before printing?"]
                };
</pre></p>
<h2>
<a name="sub purge8st7f {"></a>
15 sub purge8st7f {
</h2>
<p><pre>
    #
    # title : eliminate multiple definition of shortcuts
    #
    # aim : read a file possibly containing shortcuts
    #       and retain only the first one (other
    #       lines are eliminated.
    # 
    # output : 1 if work is well done, if not
    #            an error message.
    #
    # arguments
    my $hrsub = {fil  =>[  undef,  "c","The file to scrutate"],
		 imp  =>[      0,  "n","Must multiple occurrence be displayed?"]
                };
</pre></p>
<h2>
<a name="sub read8ic7f {"></a>
16 sub read8ic7f {
</h2>
<p><pre>
    #
    # title : read an icf file to extract some components
    #         for the collection of pictures
    #
    # aim : get information about images, a typical
    #       example is required sizes.
    # 
    # output : a hash whose keys are the picture names
    #          the values being references to a hash whose
    #          keys are the asled types and values the
    #          reference to the type value.
    #
    # arguments
    my $hrsub = {icf  =>[undef,  "c","The name of the raw index file"],
                 typ  =>[  "h",  "c","String of the types to be extracted.",
                                     "For instance 'tp' to obtain only the time and place pi.",
                                     'Possible constants are listed in the local @titi']   
                };
</pre></p>
<h2>
<a name="sub read8sl7f {"></a>
17 sub read8sl7f {
</h2>
<p><pre>
    #
    # title : reading a slf file
    #
    # aim : read, check and developp the content of a slf file.
    #      'slf' means SeLection definition File".
    # 
    # output : a reference to a hash having as keys
    #            the possible combinations of selection types defined
    #            in phoges::sety[1,2,3] hashes.
    #         The associated values are reference to an
    #           array having the words (or time period) defining
    #           the criteria selection.
    #
    #         BUT in case of inconsistency, an error object is
    #         returned which can be checked with &uie::err9 and
    #         displayed with &uie::print8err.
    #
    # arguments
    my $hrsub = {fil  =>[undef,  "c","The file to be read"]
                };
</pre></p>
<h2>
<a name="sub read8st7f {"></a>
18 sub read8st7f {
</h2>
<p><pre>
    #
    # title : reading a stf file
    #
    # aim : read and developp the content of a stf file.
    #      'stf' means ShortcuT Definition File".
    # 
    # output : a reference to a hash having as keys
    #            the values of %phoges::idrf.
    #         The associated values are references to hashes
    #           having shortcuts for keys and their definition
    #           for values.
    #
    #         BUT in case of inconsistency, an error object is
    #         returned which can be checked with &uie::err9 and
    #         displayed with &uie::print8err.
    #
    # arguments
    my $hrsub = {fil  =>[undef,  "c","The file to be read"],
                 ref  =>[{},  "h","The previous reference to complete.",
                                   "It is advised that it be the result",
                                   "of a previous call with 'read8st7f.",
                                   "Particularly, only specific keys", '(%idrf)',
                                   "are admitted."]
                };
</pre></p>
<h2>
<a name="sub select8image {"></a>
19 sub select8image {
</h2>
<p><pre>
    #
    # title : selection of images
    #
    # aim : basic function for selection
    # 
    # output : 1 if selected 0 if not,
    #         or an error in case of any inconsistency.
    #
    # arguments
    my $hrsub = {ima  =>[undef,  "h","The pi.s describing the image"],
                 cri  =>[undef,  "h","array of the criteria for selection,",
                                     "simple regulars expression are admissible."]
                };
</pre></p>
<h2>
<a name="sub shrink8di7f {"></a>
20 sub shrink8di7f {
</h2>
<p><pre>
    #
    # title : shrink a dif and increase its levels
    #
    # aim : from a decoded index file (dif) produce
    #      a reduced one to its circumstances comprising
    #      images. And, possibly, increasing by the same
    #      number all its circumstances.
    # 
    # output : 1 when the analysis of the edited
    #         file was without trouble, if not an 
    #         error message testable with '&uie::check8err'.
    #
    # arguments
    my $hrsub = {idi  =>[undef,  "c","The root of the input dif file to transform",
                                     "('-dif.txt' suffix will be added)."],
                 odi  =>[undef,  "c","The root of the transformed file to create",
                                     "('-dif.txt' suffix will be added)."],
                 inc  =>[    0,  "n","The amount of levels to add to each circumstance"],
                 new  =>[    1,  "n","Must not the 'out' file to already exist?",
                                     "If so a message error is issued."]
                };
</pre></p>
<h2>
<a name="sub st4f {"></a>
21 sub st4f {
</h2>
<p><pre>
    #
    # title : get shortcuts from a 'stf' 
    #
    # aim : read the 'stf' file and returns
    #       the asked shorcuts
    # 
    # output : a reference to a hash having
    #            shortcuts as keys and definitions
    #            as associated values,
    #          or possibly an error message.
    #
    # arguments
    my $hrsub = {fil  =>[  undef,  "c","The file to scrutate"],
		 whi  =>[["cat"],  "a","Reference to the array of the desired",
			               "type shortcuts. When empty, all types",
                                       "are considered"]
                };
</pre></p>
<h2>
<a name="sub update8col7pi {"></a>
22 sub update8col7pi {
</h2>
<p><pre>
    #
    # title : update the collective pi.s
    #
    # aim : an ancillary functions to update the current collective pi.s.
    # 
    # output : the updated collective pi
    #         or an error when something was not
    #         acceptable
    #
    # arguments
    my $hrsub = {cop  =>[undef,  "h","The COL pi series to be updated"],
                 sup  =>[undef,  "h","The col-pi series or cir-pi to use"]
                };
</pre></p>
<h2>
<a name="sub update8st7pi {"></a>
23 sub update8st7pi {
</h2>
<p><pre>
    #
    # title : replace shortcuts by their values
    #
    # aim : copy and transform a [ind,col] pi replacing
    #      and relocalizing shortcuts with
    #      their associated values.
    # 
    # output : an error object if something
    #         was wrong, if not the transformed
    #         pi.
    #
    #
    # arguments
    my $hrsub = {xpi  =>[undef,  "h","Initial pi.s with possible shortcuts"],
                 stc  =>[   {},  "h","Definition of the shortcuts, as provided",
                                     "by 'read8st7f"]
                };
</pre></p>
<h2>
A total of 22 test scripts was detected:
</h2>
<p><pre>
</pre></p>
<ol>
<li>
<a href="phoges_analyze8line.pl">
phoges_analyze8line.pl
</a>
</li>
<li>
<a href="phoges_analyze8named7vector.pl">
phoges_analyze8named7vector.pl
</a>
</li>
<li>
<a href="phoges_check8pi.pl">
phoges_check8pi.pl
</a>
</li>
<li>
<a href="phoges_col7pi2ind7pi.pl">
phoges_col7pi2ind7pi.pl
</a>
</li>
<li>
<a href="phoges_di7f2tex1htm.pl">
phoges_di7f2tex1htm.pl
</a>
</li>
<li>
<a href="phoges_ei7f2di7f1ic7f.pl">
phoges_ei7f2di7f1ic7f.pl
</a>
</li>
<li>
<a href="phoges_fit8image.pl">
phoges_fit8image.pl
</a>
</li>
<li>
<a href="phoges_get8date.pl">
phoges_get8date.pl
</a>
</li>
<li>
<a href="phoges_image9.pl">
phoges_image9.pl
</a>
</li>
<li>
<a href="phoges_new7pi.pl">
phoges_new7pi.pl
</a>
</li>
<li>
<a href="phoges_pi2line.pl">
phoges_pi2line.pl
</a>
</li>
<li>
<a href="phoges_pi9.pl">
phoges_pi9.pl
</a>
</li>
<li>
<a href="phoges_print8pi.pl">
phoges_print8pi.pl
</a>
</li>
<li>
<a href="phoges_purge8st7f.pl">
phoges_purge8st7f.pl
</a>
</li>
<li>
<a href="phoges_read8ic7f.pl">
phoges_read8ic7f.pl
</a>
</li>
<li>
<a href="phoges_read8sl7f.pl">
phoges_read8sl7f.pl
</a>
</li>
<li>
<a href="phoges_read8st7f.pl">
phoges_read8st7f.pl
</a>
</li>
<li>
<a href="phoges_select8image.pl">
phoges_select8image.pl
</a>
</li>
<li>
<a href="phoges_shrink8di7f.pl">
phoges_shrink8di7f.pl
</a>
</li>
<li>
<a href="phoges_st4f.pl">
phoges_st4f.pl
</a>
</li>
<li>
<a href="phoges_update8col7pi.pl">
phoges_update8col7pi.pl
</a>
</li>
<li>
<a href="phoges_update8st7pi.pl">
phoges_update8st7pi.pl
</a>
</li>
</ol>
</body>
</html>
